<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Gi·ªè h√†ng - TQN Shop</title>
  <link rel="stylesheet" href="../css/style.css">
</head>
<body>
  <header>
    <div class="logo">
      <span class="shop-name">TQN Shop</span>
    </div>
    <nav>
      <ul>
        <li><a href="../index.html">Trang ch·ªß</a></li>
      </ul>
    </nav>
  </header>

  <section class="cart">
    <h2>Gi·ªè h√†ng c·ªßa b·∫°n</h2>
    <div class="cart-container">
      <div class="cart-item">
        <div class="item-image">
          <img src="figure1.jpg" alt="Figure Naruto">
        </div>
        <div class="item-info">
          <h3>Figure Naruto</h3>
          <p class="item-description">M√¥ h√¨nh nh√¢n v·∫≠t Naruto ch·∫•t l∆∞·ª£ng cao</p>
          <p class="item-price">500.000ƒë</p>
        </div>
        <div class="quantity-controls">
          <button class="qty-btn minus">-</button>
          <input type="number" value="1" min="1" class="quantity-input">
          <button class="qty-btn plus">+</button>
        </div>
        <div class="item-total">
          <p class="total-price">500.000ƒë</p>
          <button class="remove-btn">üóëÔ∏è X√≥a</button>
        </div>
      </div>
      
      <div class="cart-item">
        <div class="item-image">
          <img src="figure2.jpg" alt="Figure Luffy">
        </div>
        <div class="item-info">
          <h3>Figure Luffy</h3>
          <p class="item-description">M√¥ h√¨nh nh√¢n v·∫≠t Luffy One Piece</p>
          <p class="item-price">450.000ƒë</p>
        </div>
        <div class="quantity-controls">
          <button class="qty-btn minus">-</button>
          <input type="number" value="2" min="1" class="quantity-input">
          <button class="qty-btn plus">+</button>
        </div>
        <div class="item-total">
          <p class="total-price">900.000ƒë</p>
          <button class="remove-btn">üóëÔ∏è X√≥a</button>
        </div>
      </div>
    </div>
    
    <div class="checkout">
      <div class="cart-summary">
        <p>T·∫°m t√≠nh: <span class="subtotal">1.400.000ƒë</span></p>
        <p>Ph√≠ v·∫≠n chuy·ªÉn: <span class="shipping">30.000ƒë</span></p>
        <hr>
        <p class="grand-total"><strong>T·ªïng c·ªông: 1.430.000ƒë</strong></p>
      </div>
      <div class="checkout-actions">
        <button class="continue-shopping">‚Üê Ti·∫øp t·ª•c mua s·∫Øm</button>
        <button class="checkout-btn">Thanh to√°n ngay</button>
      </div>
    </div>
  </section>

  <footer>
    <p>&copy; 2025 TQN Shop. All rights reserved. | C·ª≠a h√†ng Figure ch√≠nh h√£ng s·ªë 1 Vi·ªát Nam</p>
  </footer>

  <script>
    // T·∫£i gi·ªè h√†ng t·ª´ localStorage
    function loadCartFromStorage() {
      const cart = JSON.parse(localStorage.getItem('cart')) || [];
      const buyNowProduct = JSON.parse(localStorage.getItem('buyNowProduct'));
      
      // N·∫øu c√≥ s·∫£n ph·∫©m mua ngay, th√™m v√†o gi·ªè h√†ng t·∫°m th·ªùi
      if (buyNowProduct) {
        cart.push(buyNowProduct);
        localStorage.removeItem('buyNowProduct'); // X√≥a sau khi s·ª≠ d·ª•ng
      }
      
      if (cart.length === 0) {
        document.querySelector('.cart-container').innerHTML = 
          '<div class="empty-cart"><h3>üõí Gi·ªè h√†ng tr·ªëng</h3><p>H√£y th√™m s·∫£n ph·∫©m v√†o gi·ªè h√†ng ƒë·ªÉ ti·∫øp t·ª•c mua s·∫Øm!</p><a href="../index.html">‚Üê Quay v·ªÅ trang ch·ªß</a></div>';
        
        // ·∫®n ph·∫ßn checkout khi gi·ªè h√†ng tr·ªëng
        document.querySelector('.checkout').style.display = 'none';
        return;
      } else {
        // Hi·ªán ph·∫ßn checkout khi c√≥ s·∫£n ph·∫©m
        document.querySelector('.checkout').style.display = 'block';
      }
      
      // T·∫°o HTML cho c√°c s·∫£n ph·∫©m trong gi·ªè h√†ng
      let cartHTML = '';
      cart.forEach((item, index) => {
        cartHTML += `
          <div class="cart-item" data-id="${item.id}">
            <div class="item-image">
              <img src="../${item.image}" alt="${item.name}">
            </div>
            <div class="item-info">
              <h3>${item.name}</h3>
              <p class="item-description">M√¥ h√¨nh ch·∫•t l∆∞·ª£ng cao ch√≠nh h√£ng</p>
              <p class="item-price">${item.price.toLocaleString('vi-VN')}ƒë</p>
            </div>
            <div class="quantity-controls">
              <button class="qty-btn minus">-</button>
              <input type="number" value="${item.quantity}" min="1" class="quantity-input">
              <button class="qty-btn plus">+</button>
            </div>
            <div class="item-total">
              <p class="total-price">${(item.price * item.quantity).toLocaleString('vi-VN')}ƒë</p>
              <button class="remove-btn">üóëÔ∏è X√≥a</button>
            </div>
          </div>
        `;
      });
      
      document.querySelector('.cart-container').innerHTML = cartHTML;
      
      // G·ªçi l·∫°i setupEventListeners sau khi t·∫°o HTML m·ªõi
      setTimeout(() => {
        setupEventListeners();
        updateGrandTotal(); // G·ªçi sau khi setup xong
      }, 100);
    }

    // X·ª≠ l√Ω tƒÉng/gi·∫£m s·ªë l∆∞·ª£ng
    document.addEventListener('DOMContentLoaded', function() {
      // T·∫£i gi·ªè h√†ng t·ª´ localStorage tr∆∞·ªõc
      loadCartFromStorage();
      
      // ƒê·∫£m b·∫£o t·ªïng ti·ªÅn ƒë∆∞·ª£c t√≠nh ƒë√∫ng khi trang load
      setTimeout(() => {
        updateGrandTotal();
      }, 200);
      setupEventListeners();
    });
    
    function setupEventListeners() {
      const minusButtons = document.querySelectorAll('.minus');
      const plusButtons = document.querySelectorAll('.plus');
      const quantityInputs = document.querySelectorAll('.quantity-input');
      const removeButtons = document.querySelectorAll('.remove-btn');
      
      // X·ª≠ l√Ω n√∫t gi·∫£m s·ªë l∆∞·ª£ng
      minusButtons.forEach((btn, index) => {
        btn.addEventListener('click', function() {
          const input = quantityInputs[index];
          let currentValue = parseInt(input.value);
          if (currentValue > 1) {
            input.value = currentValue - 1;
            updateTotal(index);
          }
        });
      });
      
      // X·ª≠ l√Ω n√∫t tƒÉng s·ªë l∆∞·ª£ng
      plusButtons.forEach((btn, index) => {
        btn.addEventListener('click', function() {
          const input = quantityInputs[index];
          let currentValue = parseInt(input.value);
          input.value = currentValue + 1;
          updateTotal(index);
        });
      });
      
      // X·ª≠ l√Ω thay ƒë·ªïi s·ªë l∆∞·ª£ng tr·ª±c ti·∫øp
      quantityInputs.forEach((input, index) => {
        input.addEventListener('change', function() {
          if (parseInt(this.value) < 1) {
            this.value = 1;
          }
          updateTotal(index);
        });
      });
      
      // X·ª≠ l√Ω n√∫t x√≥a s·∫£n ph·∫©m
      removeButtons.forEach((btn, index) => {
        btn.addEventListener('click', function() {
          if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a s·∫£n ph·∫©m n√†y?')) {
            const cartItem = btn.closest('.cart-item');
            cartItem.style.animation = 'slideOut 0.3s ease-out';
            setTimeout(() => {
              cartItem.remove();
              updateCartInStorage();
              
              // Ki·ªÉm tra n·∫øu gi·ªè h√†ng tr·ªëng sau khi x√≥a
              const remainingItems = document.querySelectorAll('.cart-item');
              if (remainingItems.length === 0) {
                document.querySelector('.cart-container').innerHTML = 
                  '<div class="empty-cart"><h3>üõí Gi·ªè h√†ng tr·ªëng</h3><p>H√£y th√™m s·∫£n ph·∫©m v√†o gi·ªè h√†ng ƒë·ªÉ ti·∫øp t·ª•c mua s·∫Øm!</p><a href="../index.html">‚Üê Quay v·ªÅ trang ch·ªß</a></div>';
                document.querySelector('.checkout').style.display = 'none';
                localStorage.removeItem('cart'); // X√≥a gi·ªè h√†ng tr·ªëng kh·ªèi localStorage
              } else {
                updateGrandTotal();
              }
            }, 300);
          }
        });
      });
      
      // C·∫≠p nh·∫≠t t·ªïng ti·ªÅn c·ªßa t·ª´ng s·∫£n ph·∫©m
      function updateTotal(index) {
        // C·∫≠p nh·∫≠t localStorage tr∆∞·ªõc
        updateCartInStorage();
        // Sau ƒë√≥ c·∫≠p nh·∫≠t hi·ªÉn th·ªã t·ªïng ti·ªÅn
        updateGrandTotal();
      }
      
      // C·∫≠p nh·∫≠t gi·ªè h√†ng trong localStorage
      function updateCartInStorage() {
        const cartItems = document.querySelectorAll('.cart-item');
        const cart = [];
        
        cartItems.forEach(item => {
          const id = parseInt(item.dataset.id);
          const name = item.querySelector('.item-info h3').textContent;
          const price = parseFloat(item.querySelector('.item-price').textContent.replace(/[^\d]/g, ''));
          const quantity = parseInt(item.querySelector('.quantity-input').value);
          const image = item.querySelector('.item-image img').src.replace(window.location.origin + '/', '').replace('../', '');
          
          cart.push({ id, name, price, quantity, image });
        });
        
        localStorage.setItem('cart', JSON.stringify(cart));
      }
      
      // C·∫≠p nh·∫≠t t·ªïng ti·ªÅn t·∫•t c·∫£
      function updateGrandTotal() {
        const cartItems = document.querySelectorAll('.cart-item');
        let subtotal = 0;
        
        // T√≠nh t·ªïng t·ª´ng s·∫£n ph·∫©m
        cartItems.forEach(item => {
          const priceText = item.querySelector('.item-price').textContent;
          const quantityValue = parseInt(item.querySelector('.quantity-input').value);
          
          // L·∫•y gi√° ti·ªÅn (lo·∫°i b·ªè d·∫•u ph·∫©y v√† k√Ω t·ª± ƒë)
          const price = parseFloat(priceText.replace(/[.,ƒë\s]/g, ''));
          const itemTotal = price * quantityValue;
          
          // C·∫≠p nh·∫≠t total-price cho item n√†y
          item.querySelector('.total-price').textContent = 
            new Intl.NumberFormat('vi-VN').format(itemTotal) + 'ƒë';
          
          subtotal += itemTotal;
        });
        
        const shipping = 30000;
        const grandTotal = subtotal + shipping;
        
        // C·∫≠p nh·∫≠t c√°c ph·∫ßn t·ª≠ hi·ªÉn th·ªã t·ªïng ti·ªÅn
        const subtotalElement = document.querySelector('.subtotal');
        const grandTotalElement = document.querySelector('.grand-total strong');
        
        if (subtotalElement) {
          subtotalElement.textContent = new Intl.NumberFormat('vi-VN').format(subtotal) + 'ƒë';
        }
        
        if (grandTotalElement) {
          grandTotalElement.textContent = 'T·ªïng c·ªông: ' + new Intl.NumberFormat('vi-VN').format(grandTotal) + 'ƒë';
        }
      }
      
      // X·ª≠ l√Ω n√∫t ti·∫øp t·ª•c mua s·∫Øm
      document.querySelector('.continue-shopping').addEventListener('click', function() {
        window.location.href = '../index.html';
      });
    }
  </script>

  <style>
    @keyframes slideOut {
      from { opacity: 1; transform: translateX(0); }
      to { opacity: 0; transform: translateX(-100%); }
    }
  </style>
</body>
</html>
